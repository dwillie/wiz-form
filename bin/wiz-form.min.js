angular.module("wiz",[]).directive("wizForm",function(){return{restrict:"E",template:'<div class="wizard-body">\n\n  <div ng-transclude class="inner">\n  </div>\n\n  <div ng-show="steps[currentStep].show_controls()">\n\n    <div class="wizard-control previous">\n      <button class="wizard-btn previous" ng-click="previousStep()" ng-show="currentStep > 0">\n        {{ previousText() || \'Previous\' }}\n      </button>\n    </div>\n\n    <div class="wizard-control next">\n      <div class="error">\n        <span ng-show="isError()">{{ message.error }}</span>\n        <button class="wizard-btn next" ng-click="nextStep()" ng-hide="lastStep()">\n          {{ nextText() || \'Next\' }}\n        </button>\n        <button class="wizard-btn finish" ng-click="nextStep()" ng-show="lastStep()">\n          {{ nextText() || \'Finish\' }}\n        </button>\n      </div>\n    </div>\n\n  </div>\n</div>',transclude:!0,replace:!0,scope:{onFinish:"&",wizardMeta:"="},controller:["$scope",function(a){return a.steps=[],a.currentStep=0,null!=a.wizardMeta&&(a.wizardMeta.activeStep=0),this.registerStep=function(b){return a.steps.push(b),a.wizardMeta&&(a.wizardMeta.totalSteps=a.steps.length,1===a.steps.length&&(a.wizardMeta.activeStepName=a.steps[0].name)),a.steps.length-1},this.getCurrentStep=function(){return a.currentStep},a.nextText=function(){return a.steps[a.currentStep]&&a.steps[a.currentStep].next_text?a.steps[a.currentStep].next_text:!1},a.previousText=function(){return a.steps[a.currentStep]&&a.steps[a.currentStep].previous_text?a.steps[a.currentStep].previous_text:!1},a.isError=function(){return null!=a.message&&null!=a.message.error},a.previousStep=function(){return a.currentStep>0?a.currentStep-=1:void 0},a.lastStep=function(){return a.currentStep>=a.steps.length-1},a.nextStep=function(){var b;return a.message=void 0,b=a.steps[a.currentStep].ready_check,null!=b&&(a.message=b(),a.isError())?void 0:a.lastStep()?a.onFinish?a.onFinish():void 0:a.currentStep+=1},a.$watch("currentStep",function(){return a.wizardMeta&&a.steps[a.currentStep]?(a.wizardMeta.activeStep=a.currentStep,a.wizardMeta.activeStepName=a.steps[a.currentStep].name):void 0}),a.$watch("wizardMeta.activeStep",function(){if(null!=a.wizardMeta){for(;a.currentStep<a.wizardMeta.activeStep&&(a.nextStep(),!a.isError()););for(;a.currentStep>a.wizardMeta.activeStep&&(a.previousStep(),!a.isError()););return a.isError()?(a.wizardMeta.activeStep=a.currentStep,a.wizardMeta.activeStepName=a.steps[a.currentStep].name):void 0}}),a.$watch("wizardMeta.activeStepName",function(){var b,c,d,e,f,g;if(null!=a.wizardMeta&&a.steps[a.currentStep].name!==a.wizardMeta.activeStepName){for(f=a.steps,g=[],b=d=0,e=f.length;e>d;b=++d)c=f[b],c.name===a.wizardMeta.activeStepName?g.push(a.wizardMeta.activeStep=b):g.push(void 0);return g}}),this}]}}).directive("wizStep",function(){return{restrict:"E",template:"<div ng-show='wizFormCtrl.getCurrentStep() == stepIndex'><div ng-transclude></div></div>",transclude:!0,replace:!0,require:"^wizForm",scope:{readyCheck:"&",nextText:"@",previousText:"@",showControls:"&"},link:function(a,b,c,d){return a.wizFormCtrl=d,c.readyCheck||(a.readyCheck=null),c.showControls||(a.showControls=function(){return!0}),a.stepIndex=d.registerStep({name:c.name,element:b,ready_check:a.readyCheck,next_text:a.nextText,previous_text:a.previousText,show_controls:a.showControls})}}});